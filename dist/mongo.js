!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("prop-types"),require("mongodb")):"function"==typeof define&&define.amd?define(["prop-types","mongodb"],t):"object"==typeof exports?exports.mongo=t(require("prop-types"),require("mongodb")):e.mongo=t(e["prop-types"],e.mongodb)}(window,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=33)}({0:function(t,n){t.exports=e},11:function(e,t,n){"use strict";n.r(t),n.d(t,"deserialize",function(){return c}),n.d(t,"any",function(){return f}),n.d(t,"array",function(){return l}),n.d(t,"bool",function(){return p}),n.d(t,"func",function(){return d}),n.d(t,"number",function(){return h}),n.d(t,"object",function(){return y}),n.d(t,"string",function(){return b}),n.d(t,"node",function(){return m}),n.d(t,"element",function(){return v}),n.d(t,"symbol",function(){return g}),n.d(t,"instanceOf",function(){return w}),n.d(t,"oneOf",function(){return _}),n.d(t,"oneOfType",function(){return O}),n.d(t,"arrayOf",function(){return x}),n.d(t,"objectOf",function(){return j}),n.d(t,"shape",function(){return k}),n.d(t,"exact",function(){return R});var r=n(0),o=n.n(r);function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i={},c=function(e){return a(JSON.parse(e))},a=function(e){var t=function(e){return i[e]}(e._c_);if(t)return new t(e);throw new Error("Could not convert to model: ".concat(JSON.stringify(e)))},s=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var u=this.constructor,c=u.schema,a=u.defaultValues,s=void 0===a?{}:a,f=u.name;o.a.checkPropTypes(c,n,"prop",f),i[f]=this.constructor,Object.defineProperty(this,"_props_",{value:{},writable:!1,enumerable:!1}),Object.defineProperty(this,"_updates_",{value:{},writable:!1,enumerable:!1}),Object.defineProperty(this,"_c_",{value:f,writable:!1,enumerable:!0}),Object.keys(c).forEach(function(e){var o=void 0===n[e]?s[e]:n[e];void 0!==o&&(t._props_[e]=o),Object.defineProperty(t,e,{enumerable:!0,get:function(){return void 0===this._updates_[e]?this._props_[e]:this._updates_[e]},set:function(t){if(!r)throw new Error("Not writable: ".concat(f,".").concat(e));t!==this._updates_[e]&&(this._updates_[e]=t)}})})}return function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(e,[{key:"updates",value:function(){return this._updates_}},{key:"resetUpdates",value:function(){var e=this;Object.keys(this._updates_).forEach(function(t){e._props_[t]=e._updates_[t],delete e._updates_[t]})}},{key:"serialize",value:function(){return JSON.stringify(this)}},{key:"toJS",value:function(){return JSON.parse(JSON.stringify(this))}}]),e}();t.default=s;var f=o.a.any,l=o.a.array,p=o.a.bool,d=o.a.func,h=o.a.number,y=o.a.object,b=o.a.string,m=o.a.node,v=o.a.element,g=o.a.symbol,w=o.a.instanceOf,_=o.a.oneOf,O=o.a.oneOfType,x=o.a.arrayOf,j=o.a.objectOf,k=o.a.shape,R=o.a.exact},15:function(e,n){e.exports=t},33:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return w}),n.d(t,"saveMany",function(){return _}),n.d(t,"MongoModel",function(){return O});var r=n(15),o=n.n(r),u=n(11);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){p(e,t,n[t])})}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,u,i){try{var c=e[u](i),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var u=e.apply(t,n);function i(e){d(u,r,o,i,c,"next",e)}function c(e){d(u,r,o,i,c,"throw",e)}i(void 0)})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}var v=o.a.MongoClient,g=o.a.ObjectId,w=function(){function e(t){y(this,e),this.url=t}return m(e,[{key:"connect",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.connect(this.url,{useNewUrlParser:!0});case 2:this.client=e.sent,this.db=this.client.db();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.close());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"collectionExists",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collections();case 2:return e.t0=function(e){return e.collectionName===t},e.abrupt("return",!!e.sent.find(e.t0));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createCollection",value:function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.createCollection(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"collection",value:function(e){return this.db.collection(e)}},{key:"addModel",value:function(){var e=h(regeneratorRuntime.mark(function e(t){var n,r,o,i,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t).collection,o=n.name,n.schema.id=u.string,i=r||o,e.next=6,this.collectionExists(i);case 6:if(!e.sent){e.next=10;break}n._collection=this.collection(i),e.next=13;break;case 10:return e.next=12,this.createCollection(i);case 12:n._collection=e.sent;case 13:n.one=function(){var e=h(regeneratorRuntime.mark(function e(t){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=l({},t)).id&&(r._id=new g(r.id),delete r.id),e.next=4,n._collection.findOne(r);case 4:if(!(o=e.sent)){e.next=7;break}return e.abrupt("return",new n(o));case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.find=function(){var e=h(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,n._collection.find(t).forEach(function(e){r.push(new n(e))});case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.reset=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._collection.drop();case 2:return e.next=4,c.createCollection(i);case 4:n._collection=e.sent;case 5:case"end":return e.stop()}},e,this)})),n.deleteAll=h(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._collection.deleteMany({}));case 1:case"end":return e.stop()}},e,this)})),n.createIndex=h(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=n._collection).createIndex.apply(t,r));case 1:case"end":return e.stop()}},e,this)}));case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),_=function(){var e=h(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=new Map,t.forEach(function(e){var t=n.get(e.collection)||[];n.set(e.collection,f(t).concat([e]))}),n.forEach(function(){var e=h(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.filter(function(e){return!!e.id}).forEach(function(){var e=h(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.save());case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),e.next=3,n.insertMany(t.filter(function(e){return!e.id}).map(function(e){var t=l({},e);return delete t.id,t}));case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),O=function(e){function t(e){var n;y(this,t);var r=e.id||e._id;return n=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?s(e):t}(this,c(t).call(this,l({},e,{id:r?String(r):void 0}),!0)),e._id&&Object.defineProperty(s(s(n)),"ts",{value:e._id.getTimestamp(),writable:!1,enumerable:!0}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,u["default"]),m(t,[{key:"save",value:function(){var e=h(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.id){e.next=5;break}return e.next=3,this.collection.updateOne({_id:new g(this.id)},{$set:this.updates()});case 3:e.next=12;break;case 5:return delete(t=l({},this)).id,e.t0=String,e.next=10,this.collection.insertOne(t);case 10:e.t1=e.sent.insertedId,this.id=(0,e.t0)(e.t1);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"collection",get:function(){return this.constructor._collection}}]),t}()}})});